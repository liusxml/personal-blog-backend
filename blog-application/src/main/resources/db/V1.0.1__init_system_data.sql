-- ========================================================
-- 文件名: V1.0.1__init_system_data.sql
-- 描述: 初始化系统模块数据（角色和管理员账户）
-- 作者: liusxml
-- 日期: 2025-12-08
-- 版本: 2.0 (优化版)
-- ========================================================

-- 确保在正确的数据库中执行
USE
blog_db;

-- ========================================================
-- 1. 插入系统角色
-- ========================================================
-- 注意：role_sort 值越小，优先级越高
INSERT
IGNORE INTO sys_role (id, role_name, role_key, role_sort, status, version, create_time, update_time, is_deleted, remark)
VALUES
    (1, '超级管理员', 'ADMIN', 10, 1, 0, NOW(), NOW(), 0, '系统超级管理员，拥有所有权限'),
    (2, '作者', 'AUTHOR', 20, 1, 0, NOW(), NOW(), 0, '可以发布和管理文章、评论'),
    (3, '普通用户', 'USER', 30, 1, 0, NOW(), NOW(), 0, '普通用户，可以浏览和评论');

-- ========================================================
-- 2. 插入管理员账户
-- ========================================================
-- 用户名: admin
-- 密码: Admin@123 (BCrypt 加密后的哈希值)
-- 说明: 生产环境请务必修改默认密码！
INSERT
IGNORE INTO sys_user (id, username, nickname, password, email, avatar, status, version, create_time, update_time, is_deleted, remark)
VALUES
    (1, 'admin', '系统管理员',
     '$2a$10$7qgQFFCT.GmWZhgA6.4ppuZyd.LIpL8v.9k9SGC7Kjxf9DtJEx4/S',
     'admin@blog.com',
     NULL,
     1,
     0,
     NOW(),
     NOW(),
     0,
     '系统初始管理员账户，请及时修改密码');

-- ========================================================
-- 3. 为管理员分配所有角色
-- ========================================================
INSERT
IGNORE INTO sys_user_role (user_id, role_id)
VALUES
    (1, 1), -- ADMIN (超级管理员)
    (1, 2), -- AUTHOR (作者)
    (1, 3); -- USER (普通用户)

-- ========================================================
-- 说明
-- ========================================================
-- 1. 使用 INSERT IGNORE 确保幂等性，重复执行不会报错
-- 2. 默认管理员账户：
--    - 用户名: admin
--    - 密码: Admin@123
--    - 邮箱: admin@blog.com
-- 3. 角色优先级（role_sort）：
--    - ADMIN: 10 (最高)
--    - AUTHOR: 20
--    - USER: 30 (最低)
-- 4. ⚠️ 生产环境部署前必须修改默认密码！
